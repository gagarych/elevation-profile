(function(){var a,b,c,d,e,f,g,h,i;for(a=function(){function a(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U;for(null==c&&(c={}),y=c,null==y.height&&(y.height=400),null==y.width&&(y.width=a.node().offsetWidth),null==y.padding&&(y.padding=40),null==y.baseElevation&&(y.baseElevation=1500),null==y.extraElevation&&(y.extraElevation=500),null==y.gMapZoomLevel&&(y.gMapZoomLevel=11),b=b.sort(function(a,b){return a.distance-b.distance}),J=d3.scale.linear().domain([0,d3.max(b,function(a){return a.distance})]).range([y.padding,y.width]),M=d3.scale.linear().domain([y.baseElevation,d3.max(b,function(a){return a.elevation})+y.extraElevation]).range([y.height-y.padding,y.padding]),L=function(a){return J(a.distance)},P=function(a){return M(a.elevation)},q=function(a){return new google.maps.LatLng(a.lat,+a.lng)},o=function(a,c){var d;return new google.maps.Polyline({path:function(){var a,c,e;for(e=[],a=0,c=b.length;c>a;a++)d=b[a],e.push(q(d.location));return e}(),strokeColor:c,strokeOpacity:1,strokeWeight:a,map:u})},k=q(b[b.length/2].location),h=a.append("div").attr("class","gmap").style("width",y.width+"px").style("height",y.height+"px"),u=new google.maps.Map(h.node(),{zoom:y.gMapZoomLevel,center:k,mapTypeId:"terrain"}),o(6,"#fff"),o(3,"#600"),v=new google.maps.Marker({position:k,title:"walk"}),j=a.append("svg:svg").attr("width",y.width).attr("height",y.height),g=j.append("svg:g"),K=d3.svg.axis().scale(J).orient("bottom").ticks(10),N=d3.svg.axis().scale(M).orient("left").ticks(10),j.append("g").attr("class","axis").attr("transform","translate(0,"+(y.height-y.padding)+")").call(K).append("text").attr("x",y.width-7).attr("y",-7).style("text-anchor","end").text("km"),j.append("g").attr("class","axis").attr("transform","translate("+y.padding+",0)").call(N).append("text").attr("y",y.padding+7).attr("x",15).style("text-anchor","end").text("m"),d=d3.svg.area().x(L).y0(y.height-y.padding).y1(P),g.append("svg:path").datum(b).attr("d",d3.svg.line().x(L).y(P)),g.append("path").datum(b).attr("class","area").attr("d",d),f=g.append("g").attr("class","focus").style("display","none"),f.append("line").attr("y1",y.padding).attr("y2",y.height-y.padding),f.append("line").attr("y1",y.padding).attr("y2",y.padding).attr("x2","50px"),f.append("circle").attr("r",3),f.append("text").attr("x",3).attr("dy",y.padding-3),H=function(){return f.style("display",null),v.setMap(u)},r=function(){return f.style("display","none"),v.setMap(null)},google.maps.event.addListener(u,"mouseover",H),google.maps.event.addListener(u,"mouseout",r),google.maps.event.addListener(u,"mousemove",function(a){return G(b.reduce(function(b,c){return n(b,a.latLng)>n(c,a.latLng)?c:b}))}),n=function(a,b){return google.maps.geometry.spherical.computeDistanceBetween(q(a.location),b)},m=function(a){var c;return c=d3.bisector(function(a){return a.distance}).right,b[c(b,J.invert(a))]},O=function(a){return 0>a||a>y.width?0:M(m(a).elevation)},G=function(a){var b;return f.attr("transform","translate("+J(a.distance)+",0)"),f.select("text").text(d3.round(a.elevation,0)+"m"),f.select("circle").attr("transform","translate(0, "+M(a.elevation)+")"),b=q(a.location),v.setPosition(b)},D=function(){var a,c,d;for(d=[],a=0,c=b.length;c>a;a++)l=b[a],l.places&&d.push(l);return d}(),i=g.append("g").attr("class","notes"),e=j.append("g").style("display","none"),w=function(a){var b,c;return b=e.append("text").text(a),c=b.node().getBBox(),b.remove(),c},E=function(a,b,c){var d,e,f;return e=J(a.distance),f=O(e),d=function(a,c){return{x:a,y:c,rect:b,sx:e,sy:f}},[d(e-b.width-c,f-b.height-c),d(e+c,f-b.height-c),d(e+c,f+c-b.height-5),d(e-b.width-c,f+c-b.height-5)]},s=function(a,b){return!(b.x>a.x+a.rect.width||b.x+b.rect.width<a.x||b.y>a.y+a.rect.height||b.y+b.rect.height<a.y)},B=[],t=function(a,b){var c,d,e,f,g,h,i;if(a.x<0||a.x+b.width>y.width)return!1;for(e=0,g=B.length;g>e;e++)if(d=B[e],s(d,a))return!1;for(c=f=-10,h=b.width+10;h>=-10?h>=f:f>=h;c=h>=-10?++f:--f)if(a.y-5<(i=O(a.x+c))&&i<a.y+b.height+5)return!1;return!0},p=function(a,b){var c,d,e,f,g,h;for(f=w(b),e=25,d=E(a,f,e),g=0,h=d.length;h>g;g++)if(c=d[g],t(c,f))return c;return null},F=function(a,b){return i.append("circle").attr("cx",a.sx).attr("cy",a.sy).attr("r",1),i.append("text").attr("x",a.x).attr("y",a.y+a.rect.height).text(b.name),i.append("line").attr("x1",a.x).attr("x2",a.x+a.rect.width).attr("y1",a.y+a.rect.height+5).attr("y2",a.y+a.rect.height+5).style("text-anchor","start"),i.append("line").attr("x1",a.sx).attr("y1",a.sy).attr("x2",a.x<a.sx?a.x+a.rect.width:a.x).attr("y2",a.y+a.rect.height+5)},Q=0,S=D.length;S>Q;Q++)for(C=D[Q],U=C.places,R=0,T=U.length;T>R;R++)z=U[R],new google.maps.Marker({position:q(z.location),title:z.name,map:u}),A=p(C,z.name),A?(B.push(A),F(A,z)):console.warn("No placement for note '"+z.name+"' found");x=function(){return G(m(d3.mouse(this)[0]))},I=function(){return G(m(d3.touches(this)[0][0]))},g.append("rect").attr("class","overlay").attr("width",y.width).attr("height",y.height-y.padding).attr("dx",y.padding).attr("dy",y.padding).on("mouseover",H).on("mouseout",r).on("mousemove",x).on("touchstart",H).on("touchmove",I)}return a}(),d=function(b){return d3.json(b.attr("data-src"),function(c,d){var e,f;return c?console.warn(error):(f=b.attr("data-opts"),e=f?JSON.parse(f):{},new a(b,d,e))})},i=d3.selectAll("div[data-item='elevation-profile']"),e=0,g=i.length;g>e;e++)for(c=i[e],f=0,h=c.length;h>f;f++)b=c[f],d(d3.select(b))}).call(this);