!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});if(d.radius+d.length+d.width,e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),function(){var a,b,c,d,e,f,g,h,i,j;for(a=function(){function a(a,b,c){null==c&&(c={}),this.$container=a,this.data=b,this.options=c,this.draw()}return a.prototype.draw=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;for(c=this.$container,k=this.data,y=this.options,z=y,null==z.height&&(z.height=400),z.width=c.node().offsetWidth,null==z.padding&&(z.padding=40),null==z.baseElevation&&(z.baseElevation=1500),null==z.extraElevation&&(z.extraElevation=500),null==z.gMapZoomLevel&&(z.gMapZoomLevel=11),k=k.sort(function(a,b){return a.distance-b.distance}),K=d3.scale.linear().domain([0,d3.max(k,function(a){return a.distance})]).range([z.padding,z.width]),N=d3.scale.linear().domain([z.baseElevation,d3.max(k,function(a){return a.elevation})+z.extraElevation]).range([z.height-z.padding,z.padding]),M=function(a){return K(a.distance)},Q=function(a){return N(a.elevation)},p=function(a){return new google.maps.LatLng(a.lat,+a.lng)},n=function(a,b){var c;return new google.maps.Polyline({path:function(){var a,b,d;for(d=[],a=0,b=k.length;b>a;a++)c=k[a],d.push(p(c.location));return d}(),strokeColor:b,strokeOpacity:1,strokeWeight:a,map:t})},i=p(k[Math.floor(k.length/2)].location),c.html(""),h=c.append("svg:svg").attr("width",z.width).attr("height",z.height),f=c.append("div").attr("class","gmap").style("width",z.width+"px").style("height",z.height+"px"),t=new google.maps.Map(f.node(),{zoom:z.gMapZoomLevel,center:i,scrollwheel:!1,mapTypeId:"terrain"}),n(6,"#fff"),n(3,"#600"),u=new google.maps.Marker({position:i,title:"walk"}),e=h.append("svg:g"),L=d3.svg.axis().scale(K).orient("bottom").ticks(10),O=d3.svg.axis().scale(N).orient("left").ticks(10),h.append("g").attr("class","axis").attr("transform","translate(0,"+(z.height-z.padding)+")").call(L).append("text").attr("x",z.width-7).attr("y",-7).style("text-anchor","end").text("km"),h.append("g").attr("class","axis").attr("transform","translate("+z.padding+",0)").call(O).append("text").attr("y",z.padding+7).attr("x",15).style("text-anchor","end").text("m"),a=d3.svg.area().x(M).y0(z.height-z.padding).y1(Q),e.append("svg:path").datum(k).attr("d",d3.svg.line().x(M).y(Q)),e.append("path").datum(k).attr("class","area").attr("d",a),d=e.append("g").attr("class","focus").style("display","none"),d.append("line").attr("y1",z.padding).attr("y2",z.height-z.padding),d.append("line").attr("y1",z.padding).attr("y2",z.padding).attr("x2","50px"),d.append("circle").attr("r",3),d.append("text").attr("x",3).attr("dy",z.padding-3),I=function(){return d.style("display",null),u.setMap(t)},q=function(){return d.style("display","none"),u.setMap(null)},google.maps.event.addListener(t,"mouseover",I),google.maps.event.addListener(t,"mouseout",q),google.maps.event.addListener(t,"mousemove",function(a){return H(k.reduce(function(b,c){return m(b,a.latLng)>m(c,a.latLng)?c:b}))}),m=function(a,b){return google.maps.geometry.spherical.computeDistanceBetween(p(a.location),b)},l=function(a){var b;return b=d3.bisector(function(a){return a.distance}).right,k[b(k,K.invert(a))]},P=function(a){var b;return 0>a||a>z.width?0:(b=l(a),b?N(b.elevation):0)},H=function(a){var b;return d.attr("transform","translate("+K(a.distance)+",0)"),d.select("text").text(d3.round(a.elevation,0)+"m"),d.select("circle").attr("transform","translate(0, "+N(a.elevation)+")"),b=p(a.location),u.setPosition(b)},E=function(){var a,b,c;for(c=[],a=0,b=k.length;b>a;a++)j=k[a],j.places&&c.push(j);return c}(),g=e.append("g").attr("class","notes"),b=h.append("g"),x=function(a){return a.x<a.sx?a.x+a.rect.width:a.x},v=function(a){var c,d;return c=b.append("text").text(a),d=c.node().getBBox(),c.remove(),d},F=function(a,b,c){var d,e,f;return e=K(a.distance),f=P(e),d=function(a,c){return{x:a,y:c,rect:b,sx:e,sy:f}},[d(e-b.width-c,f-b.height-c),d(e+c,f-b.height-c),d(e+c,f+c-b.height-5),d(e-b.width-c,f+c-b.height-5)]},r=function(a,b){var c;return c=!(b.x>a.x+a.rect.width||b.x+b.rect.width<a.x||b.y>a.y+a.rect.height||b.y+b.rect.height+10<a.y),c?c:a.sx<b.sx!=x(a)<x(b)},C=[],s=function(a,b){var c,d,e,f,g,h,i;if(a.x<z.padding||a.x+b.width>z.width)return!1;for(e=0,g=C.length;g>e;e++)if(d=C[e],r(d,a))return!1;for(c=f=-10,h=b.width+10;h>=-10?h>=f:f>=h;c=h>=-10?++f:--f)if(a.y-5<(i=P(a.x+c))&&i<a.y+b.height+5)return!1;return!0},o=function(a,b){var c,d,e,f,g,h;for(f=v(b),e=30,d=F(a,f,e),g=0,h=d.length;h>g;g++)if(c=d[g],s(c,f))return c;return null},G=function(a,b){return g.append("circle").attr("cx",a.sx).attr("cy",a.sy).attr("r",1),g.append("text").attr("x",a.x).attr("y",a.y+a.rect.height).text(b.name),g.append("line").attr("x1",a.x).attr("x2",a.x+a.rect.width).attr("y1",a.y+a.rect.height+5).attr("y2",a.y+a.rect.height+5).style("text-anchor","start"),g.append("line").attr("x1",a.sx).attr("y1",a.sy).attr("x2",x(a)).attr("y2",a.y+a.rect.height+5)},R=0,T=E.length;T>R;R++)for(D=E[R],V=D.places,S=0,U=V.length;U>S;S++)A=V[S],new google.maps.Marker({position:p(A.location),title:A.name,map:t}),B=o(D,A.name),B?(C.push(B),G(B,A)):console.warn("No placement for note '"+A.name+"' found");return w=function(){return H(l(d3.mouse(this)[0]))},J=function(){return H(l(d3.touches(this)[0][0]))},e.append("rect").attr("class","overlay").attr("width",z.width).attr("height",z.height-z.padding).attr("dx",z.padding).attr("dy",z.padding).on("mouseover",I).on("mouseout",q).on("mousemove",w).on("touchstart",I).on("touchmove",J)},a}(),e=[],d=function(b){var c,d;return c={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"},d=new Spinner(c).spin(b[0][0]),d3.json(b.attr("data-src"),function(f,g){var h;return d.stop(),f?console.warn(error):(c=b.attr("data-opts"),h=c?JSON.parse(c):{},e.push(new a(b,g,h)))})},j=d3.selectAll("div[data-item='elevation-profile']"),f=0,h=j.length;h>f;f++)for(c=j[f],g=0,i=c.length;i>g;g++)b=c[g],d(d3.select(b));d3.select(window).on("resize",function(){var a,b,c,d;for(d=[],b=0,c=e.length;c>b;b++)a=e[b],d.push(a.draw());return d})}.call(this);